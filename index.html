<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ GameImpostor - Kata Mirip untuk Impostor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4A306D;
            --secondary: #6C63FF;
            --accent: #FF6B6B;
            --success: #06D6A0;
            --warning: #FFD166;
            --citizen: #4ECDC4;
            --impostor: #FF6B6B;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Screens */
        .screen {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .screen.active {
            display: block;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .game-title {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent), var(--warning), var(--citizen));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Common Elements */
        h2 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h2 i {
            color: var(--warning);
        }
        
        .player-list, .category-grid, .vote-options {
            margin: 20px 0;
        }
        
        .player-item, .category-item, .vote-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .player-item:hover, .category-item:hover, .vote-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .category-item.selected {
            background: var(--secondary);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4);
        }
        
        .vote-item.selected {
            background: var(--secondary);
        }
        
        /* Inputs & Buttons */
        .input-row {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        input, select {
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
        }
        
        button {
            padding: 12px 25px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: #5A52D5;
            transform: scale(1.05);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        /* Role Reveal */
        .role-reveal-container {
            text-align: center;
            padding: 20px;
        }
        
        .current-player {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--warning);
        }
        
        .swipe-instruction {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }
        
        .role-card {
            background: white;
            color: #333;
            padding: 40px 30px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .role-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .impostor-role {
            color: var(--impostor);
        }
        
        .citizen-role {
            color: var(--citizen);
        }
        
        .word-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary);
            text-align: center;
        }
        
        .similar-word {
            font-size: 1.5rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
        
        .category-info {
            color: #666;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .swipe-arrow {
            font-size: 4rem;
            color: rgba(255, 255, 255, 0.5);
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
            animation: bounce 2s infinite;
        }
        
        .swipe-arrow:hover {
            color: var(--warning);
            transform: scale(1.2);
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Game Play */
        .timer {
            font-size: 3.5rem;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            color: var(--warning);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .game-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        /* Similar Words Indicator */
        .similarity-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        .high-similarity { color: var(--success); }
        .medium-similarity { color: var(--warning); }
        .low-similarity { color: var(--accent); }
        
        /* Results */
        .result-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vote-count {
            background: var(--accent);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .impostor-badge {
            background: var(--impostor);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        .citizen-badge {
            background: var(--citizen);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        /* Progress */
        .progress-info {
            text-align: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Similar Words Section */
        .similar-words-section {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .similar-words-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .similar-word-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        /* Instructions */
        .instructions {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.9rem;
            border-left: 4px solid var(--warning);
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .screen {
                padding: 20px;
            }
            
            .game-title {
                font-size: 2.2rem;
            }
            
            .input-row {
                flex-direction: column;
            }
            
            .role-card {
                padding: 30px 20px;
            }
            
            .role-title {
                font-size: 2rem;
            }
            
            .word-display {
                font-size: 1.8rem;
            }
            
            .timer {
                font-size: 2.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="game-title">üéÆ GameImpostor</h1>
            <div class="subtitle">Impostor mendapatkan kata MIRIP untuk berbaur!</div>
        </div>
        
        <!-- Screen 1: Players -->
        <div id="screenPlayers" class="screen active">
            <h2><i class="fas fa-users"></i> Tambah Pemain</h2>
            <p>Tambahkan minimal 3 pemain untuk memulai game.</p>
            
            <div class="input-row">
                <input type="text" id="playerInput" placeholder="Masukkan nama pemain" autocomplete="off">
                <button onclick="addPlayer()"><i class="fas fa-plus"></i> Tambah</button>
            </div>
            
            <div class="player-list" id="playerList">
                <!-- Players will appear here -->
            </div>
            
            <div class="instructions">
                <i class="fas fa-lightbulb"></i> Tekan Enter untuk menambah pemain cepat. Minimal 3 pemain.
            </div>
            
            <button id="nextBtn" onclick="goToCategories()" disabled>
                <i class="fas fa-arrow-right"></i> Lanjut ke Kategori
            </button>
        </div>
        
        <!-- Screen 2: Categories -->
        <div id="screenCategories" class="screen">
            <h2><i class="fas fa-th-list"></i> Pilih Kategori</h2>
            <p>Pilih minimal 1 kategori. Setiap kategori punya 30+ kata.</p>
            
            <div class="category-grid" id="categoryGrid">
                <!-- Categories will appear here -->
            </div>
            
            <div class="progress-info" id="categoryProgress">0 kategori terpilih</div>
            
            <button onclick="goBackToPlayers()"><i class="fas fa-arrow-left"></i> Kembali</button>
            <button id="categoriesNextBtn" onclick="goToSettings()" disabled>
                <i class="fas fa-arrow-right"></i> Pengaturan Game
            </button>
        </div>
        
        <!-- Screen 3: Settings -->
        <div id="screenSettings" class="screen">
            <h2><i class="fas fa-cog"></i> Pengaturan Game</h2>
            
            <div class="game-info">
                <h3><i class="fas fa-user-secret"></i> Jumlah Impostor</h3>
                <div class="input-row">
                    <button onclick="changeImpostorCount(-1)" id="decreaseBtn">-</button>
                    <input type="text" id="impostorCount" value="1" readonly style="text-align: center; font-size: 1.2rem;">
                    <button onclick="changeImpostorCount(1)" id="increaseBtn">+</button>
                </div>
                <div style="text-align: center; margin-top: 10px; color: rgba(255,255,255,0.8);">
                    Rekomendasi: <span id="recommendation">1 imposter</span>
                </div>
            </div>
            
            <div class="game-info">
                <h3><i class="fas fa-brain"></i> Sistem Kata Mirip</h3>
                <p>Impostor akan mendapatkan kata yang <strong>sangat mirip</strong> dengan kata asli untuk membantu mereka berbaur!</p>
                <div class="similar-words-list" id="similarExample">
                    <!-- Similar words example -->
                </div>
            </div>
            
            <div class="game-info">
                <h3><i class="fas fa-clock"></i> Durasi Ronde</h3>
                <div class="input-row">
                    <button onclick="changeRoundTime(-30)">-30s</button>
                    <input type="text" id="roundTime" value="02:00" readonly style="text-align: center; font-size: 1.2rem;">
                    <button onclick="changeRoundTime(30)">+30s</button>
                </div>
            </div>
            
            <button onclick="goBackToCategories()"><i class="fas fa-arrow-left"></i> Kembali</button>
            <button onclick="startGame()"><i class="fas fa-play"></i> Mulai Game</button>
        </div>
        
        <!-- Screen 4: Role Reveal -->
        <div id="screenRoleReveal" class="screen">
            <div class="role-reveal-container">
                <div class="current-player" id="currentPlayerName">Ray</div>
                <div class="swipe-instruction">Klik panah untuk "swipe" dan lihat kata Anda</div>
                
                <div class="role-card" id="roleCard">
                    <div class="role-title">?</div>
                    <div class="word-display" id="wordDisplay">Swipe untuk melihat</div>
                    <div class="category-info" id="categoryInfo"></div>
                    <div class="similar-word" id="similarWordHint"></div>
                </div>
                
                <div class="swipe-arrow" id="swipeArrow" onclick="revealRole()">
                    ‚Üë<br>
                    <span style="font-size: 1rem;">KLIK UNTUK SWIPE</span>
                </div>
                
                <button id="nextPlayerBtn" onclick="nextPlayer()" style="display: none; margin-top: 20px;">
                    <i class="fas fa-arrow-right"></i> Pemain Selanjutnya
                </button>
            </div>
        </div>
        
        <!-- Screen 5: Game Play -->
        <div id="screenGame" class="screen">
            <h2><i class="fas fa-comments"></i> Waktu Diskusi</h2>
            
            <div class="timer" id="gameTimer">02:00</div>
            
            <div class="game-info">
                <h3><i class="fas fa-tag"></i> Kategori: <span id="currentCategoryDisplay">Makanan</span></h3>
                <p id="playerInstruction">Berikan petunjuk tentang kata Anda tanpa mengungkapkannya langsung!</p>
                
                <div class="similar-words-section" id="similarWordsHint">
                    <h4><i class="fas fa-random"></i> Kata-kata Mirip dalam Kategori:</h4>
                    <div class="similar-words-list" id="similarWordsList">
                        <!-- Similar words will appear here -->
                    </div>
                </div>
            </div>
            
            <div class="game-info">
                <h3><i class="fas fa-users"></i> Pemain:</h3>
                <div id="gamePlayersList">
                    <!-- Game players list -->
                </div>
            </div>
            
            <button onclick="startVoting()"><i class="fas fa-vote-yea"></i> Mulai Voting</button>
            <button onclick="skipTurn()" style="background: var(--warning); color: #333;">
                <i class="fas fa-forward"></i> Lewati Ronde
            </button>
        </div>
        
        <!-- Screen 6: Voting -->
        <div id="screenVoting" class="screen">
            <h2><i class="fas fa-vote-yea"></i> Voting Time</h2>
            <p>Pilih siapa yang menurut Anda adalah Impostor:</p>
            
            <div class="vote-options" id="voteOptions">
                <!-- Voting options will appear here -->
            </div>
            
            <div class="progress-info" id="votingProgress">Belum ada yang vote</div>
            
            <button id="submitVoteBtn" onclick="submitVote()" disabled>
                <i class="fas fa-check"></i> Submit Vote
            </button>
            <button id="seeResultsBtn" onclick="showResults()" style="display: none;">
                <i class="fas fa-chart-bar"></i> Lihat Hasil
            </button>
        </div>
        
        <!-- Screen 7: Results -->
        <div id="screenResults" class="screen">
            <h2><i class="fas fa-trophy"></i> Hasil Game</h2>
            
            <div id="resultsContent">
                <!-- Results will appear here -->
            </div>
            
            <button onclick="playAgain()" style="background: var(--success); margin-top: 30px;">
                <i class="fas fa-redo"></i> Main Lagi
            </button>
            <button onclick="resetGame()" style="background: rgba(255,255,255,0.1);">
                <i class="fas fa-home"></i> Menu Utama
            </button>
        </div>
    </div>

    <script>
        // ==================== GAME DATA ====================
        const gameData = {
            players: [],
            impostors: [],
            selectedCategories: [],
            categories: {
                "Makanan": [
                    "Pizza", "Sushi", "Rendang", "Nasi Goreng", "Hamburger", "Taco", "Pasta", "Dim Sum", 
                    "Ramen", "Croissant", "Bakso", "Satay", "Fried Chicken", "Pad Thai", "Pho", "Donat", 
                    "Es Krim", "Brownies", "Cheesecake", "Tiramisu", "Sate Ayam", "Gado-gado", "Soto Ayam", 
                    "Martabak", "Pempek", "Bakmi Goreng", "Lumpia", "Kwetiau", "Capcay", "Tahu Gejrot"
                ],
                "Selebriti": [
                    "Tom Cruise", "Beyonc√©", "Leonardo DiCaprio", "Taylor Swift", "Robert Downey Jr.", 
                    "Jennifer Lawrence", "Brad Pitt", "Ariana Grande", "Johnny Depp", "Rihanna", 
                    "Will Smith", "Angelina Jolie", "Chris Hemsworth", "Lady Gaga", "Dwayne Johnson", 
                    "Emma Watson", "Chris Evans", "Selena Gomez", "Keanu Reeves", "Miley Cyrus", 
                    "Ryan Reynolds", "Scarlett Johansson", "Justin Bieber", "Natalie Portman", "Bruno Mars", 
                    "Margot Robbie", "Harry Styles", "Anne Hathaway", "The Rock", "Zendaya"
                ],
                "Tempat": [
                    "Menara Eiffel", "Piramida Giza", "Tembok Besar China", "Taj Mahal", "Colosseum", 
                    "Patung Liberty", "Machu Picchu", "Sydney Opera House", "Bali", "Borobudur", 
                    "Grand Canyon", "Great Barrier Reef", "Venice", "Santorini", "Bora Bora", 
                    "Tokyo", "New York City", "Paris", "London", "Dubai", "Rio de Janeiro", 
                    "Cape Town", "Bangkok", "Singapore", "Hong Kong", "Roma", "Barcelona", 
                    "Amsterdam", "Prague", "Vienna"
                ],
                "Film Hollywood": [
                    "Avengers: Endgame", "Titanic", "The Godfather", "Star Wars", "Jurassic Park", 
                    "Harry Potter", "The Dark Knight", "Forrest Gump", "Inception", "Pulp Fiction", 
                    "The Matrix", "Frozen", "The Lion King", "Avatar", "The Shawshank Redemption", 
                    "Spider-Man: No Way Home", "Black Panther", "La La Land", "Joker", "Parasite", 
                    "Interstellar", "Gladiator", "The Social Network", "Casablanca", "Gone with the Wind", 
                    "Psycho", "The Silence of the Lambs", "Schindler's List", "Back to the Future", "E.T."
                ],
                "Hewan": [
                    "Harimau Sumatra", "Komodo", "Orangutan", "Gajah Asia", "Badak Jawa", 
                    "Anjing", "Kucing", "Burung Beo", "Ikan Koi", "Kelinci", "Hamster", 
                    "Ular Python", "Kadal Chameleon", "Burung Merak", "Kupu-kupu Monarch", 
                    "Panda", "Koala", "Penguin", "Singa", "Zebra", "Jerapah", "Gorilla", 
                    "Simpanse", "Kanguru", "Platypus", "Armadillo", "Sloth", "Otter", 
                    "Red Panda", "Flamingo"
                ]
            },
            // Similar words mapping for impostors
            similarWordsMap: {
                "Pizza": ["Pasta", "Lasagna", "Calzone", "Focaccia", "Garlic Bread"],
                "Sushi": ["Sashimi", "Tempura", "Maki", "Nigiri", "Ramen"],
                "Rendang": ["Gulai", "Kari", "Semur", "Opor", "Kalio"],
                "Nasi Goreng": ["Mie Goreng", "Bihun Goreng", "Kwetiau Goreng", "Capcay", "Chicken Fried Rice"],
                "Hamburger": ["Cheeseburger", "Sandwich", "Burger King", "Whopper", "Big Mac"],
                "Tom Cruise": ["Brad Pitt", "Leonardo DiCaprio", "Matt Damon", "Will Smith", "Johnny Depp"],
                "Beyonc√©": ["Rihanna", "Lady Gaga", "Ariana Grande", "Taylor Swift", "Jennifer Lopez"],
                "Menara Eiffel": ["Menara Pisa", "Patung Liberty", "Colosseum", "Big Ben", "Sydney Opera"],
                "Tokyo": ["Osaka", "Kyoto", "Seoul", "Beijing", "Shanghai"],
                "Avengers: Endgame": ["Avengers: Infinity War", "Iron Man", "Captain America", "Thor", "Black Panther"],
                "Harimau Sumatra": ["Harimau Bengal", "Singa", "Jaguar", "Leopard", "Cheetah"]
            },
            currentCategory: "",
            actualWord: "", // Kata asli untuk warga
            impostorWord: "", // Kata mirip untuk impostor
            roundDuration: 120,
            currentPlayerIndex: 0,
            votes: {},
            gameState: "setup"
        };

        // ==================== GAME FUNCTIONS ====================
        
        // Initialize the game
        function initGame() {
            // Setup categories grid
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';
            
            for (const category in gameData.categories) {
                const div = document.createElement('div');
                div.className = 'category-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight: bold; font-size: 1.1rem;">${category}</div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">${gameData.categories[category].length} kata</div>
                    </div>
                    <div style="font-size: 1.5rem;">üìö</div>
                `;
                div.onclick = () => toggleCategory(category, div);
                categoryGrid.appendChild(div);
            }
            
            // Setup similar words example
            updateSimilarExample();
            
            // Enter key for adding players
            document.getElementById('playerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addPlayer();
            });
            
            // Load from URL if any
            loadFromURL();
        }
        
        // Update similar words example
        function updateSimilarExample() {
            const exampleDiv = document.getElementById('similarExample');
            exampleDiv.innerHTML = '';
            
            const examples = [
                { actual: "Pizza", similar: "Pasta, Lasagna, Calzone" },
                { actual: "Tokyo", similar: "Osaka, Kyoto, Seoul" },
                { actual: "Beyonc√©", similar: "Rihanna, Taylor Swift, Ariana Grande" }
            ];
            
            examples.forEach(example => {
                const div = document.createElement('div');
                div.className = 'similar-word-tag';
                div.innerHTML = `<strong>${example.actual}</strong> ‚Üí ${example.similar}`;
                exampleDiv.appendChild(div);
            });
        }
        
        // Load players from URL
        function loadFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const playersParam = urlParams.get('players');
            if (playersParam) {
                playersParam.split(',').forEach(player => {
                    if (player.trim()) {
                        gameData.players.push({
                            id: Date.now() + Math.random(),
                            name: player.trim(),
                            role: null,
                            votes: 0
                        });
                    }
                });
                updatePlayerList();
                checkNextButton();
            }
        }
        
        // Player management
        function addPlayer() {
            const input = document.getElementById('playerInput');
            const name = input.value.trim();
            
            if (name && !gameData.players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                gameData.players.push({
                    id: Date.now() + Math.random(),
                    name: name,
                    role: null,
                    votes: 0
                });
                
                input.value = '';
                updatePlayerList();
                checkNextButton();
                input.focus();
            }
        }
        
        function removePlayer(id) {
            gameData.players = gameData.players.filter(p => p.id !== id);
            updatePlayerList();
            checkNextButton();
        }
        
        function updatePlayerList() {
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            
            gameData.players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <div>
                        <span style="font-weight: bold;">${player.name}</span>
                        <span style="margin-left: 10px; font-size: 0.9rem; opacity: 0.8;">
                            Pemain ${index + 1}
                        </span>
                    </div>
                    <button class="btn-small" onclick="removePlayer(${player.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                playerList.appendChild(div);
            });
        }
        
        function checkNextButton() {
            const btn = document.getElementById('nextBtn');
            const hasEnoughPlayers = gameData.players.length >= 3;
            btn.disabled = !hasEnoughPlayers;
            btn.innerHTML = hasEnoughPlayers 
                ? `<i class="fas fa-arrow-right"></i> Lanjut ke Kategori (${gameData.players.length} pemain)`
                : `<i class="fas fa-arrow-right"></i> Butuh ${3 - gameData.players.length} pemain lagi`;
        }
        
        // Category selection
        function toggleCategory(category, element) {
            const index = gameData.selectedCategories.indexOf(category);
            
            if (index === -1) {
                gameData.selectedCategories.push(category);
                element.classList.add('selected');
            } else {
                gameData.selectedCategories.splice(index, 1);
                element.classList.remove('selected');
            }
            
            // Update progress
            const count = gameData.selectedCategories.length;
            document.getElementById('categoryProgress').textContent = 
                `${count} kategori terpilih`;
            document.getElementById('categoriesNextBtn').disabled = count === 0;
        }
        
        // Game settings
        function changeImpostorCount(delta) {
            const input = document.getElementById('impostorCount');
            let count = parseInt(input.value) + delta;
            const maxImpostors = Math.max(1, Math.floor(gameData.players.length / 2));
            
            if (count >= 1 && count <= maxImpostors) {
                input.value = count;
                
                // Update recommendation
                const recommended = Math.max(1, Math.floor(gameData.players.length / 3));
                document.getElementById('recommendation').textContent = 
                    `${recommended} imposter (rekomendasi)`;
                
                // Update button states
                document.getElementById('decreaseBtn').disabled = count <= 1;
                document.getElementById('increaseBtn').disabled = count >= maxImpostors;
            }
        }
        
        function changeRoundTime(seconds) {
            let totalSeconds = gameData.roundDuration + seconds;
            if (totalSeconds >= 60 && totalSeconds <= 300) {
                gameData.roundDuration = totalSeconds;
                const minutes = Math.floor(totalSeconds / 60);
                const secs = totalSeconds % 60;
                document.getElementById('roundTime').value = 
                    `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }
        
        // Get similar word for impostor
        function getSimilarWord(actualWord) {
            // Check if we have predefined similar words
            if (gameData.similarWordsMap[actualWord]) {
                const similarWords = gameData.similarWordsMap[actualWord];
                return similarWords[Math.floor(Math.random() * similarWords.length)];
            }
            
            // Fallback: get random word from same category
            const wordsInCategory = gameData.categories[gameData.currentCategory];
            const otherWords = wordsInCategory.filter(word => word !== actualWord);
            return otherWords.length > 0 
                ? otherWords[Math.floor(Math.random() * otherWords.length)]
                : "Kata Lain";
        }
        
        // Get similarity level (for display)
        function getSimilarityLevel(actual, similar) {
            // Simple similarity check (in real app, use more complex algorithm)
            if (actual.includes(similar) || similar.includes(actual)) return "high";
            
            const actualWords = actual.toLowerCase().split(' ');
            const similarWords = similar.toLowerCase().split(' ');
            const commonWords = actualWords.filter(word => similarWords.includes(word));
            
            if (commonWords.length > 0) return "high";
            if (actual.charAt(0) === similar.charAt(0)) return "medium";
            return "low";
        }
        
        // Navigation
        function goToCategories() {
            changeScreen('screenPlayers', 'screenCategories');
        }
        
        function goBackToPlayers() {
            changeScreen('screenCategories', 'screenPlayers');
        }
        
        function goToSettings() {
            changeScreen('screenCategories', 'screenSettings');
        }
        
        function goBackToCategories() {
            changeScreen('screenSettings', 'screenCategories');
        }
        
        function changeScreen(fromId, toId) {
            document.getElementById(fromId).classList.remove('active');
            document.getElementById(toId).classList.add('active');
        }
        
        // Start the game
        function startGame() {
            // Select random impostors
            const impostorCount = parseInt(document.getElementById('impostorCount').value);
            const shuffledPlayers = [...gameData.players].sort(() => Math.random() - 0.5);
            gameData.impostors = shuffledPlayers.slice(0, impostorCount).map(p => p.id);
            
            // Assign roles
            gameData.players.forEach(player => {
                player.role = gameData.impostors.includes(player.id) ? 'impostor' : 'citizen';
            });
            
            // Select random category and word
            gameData.currentCategory = gameData.selectedCategories[
                Math.floor(Math.random() * gameData.selectedCategories.length)
            ];
            const words = gameData.categories[gameData.currentCategory];
            gameData.actualWord = words[Math.floor(Math.random() * words.length)];
            
            // Get similar word for impostor
            gameData.impostorWord = getSimilarWord(gameData.actualWord);
            
            // Reset game state
            gameData.currentPlayerIndex = 0;
            gameData.votes = {};
            
            // Show similar words for the category
            updateSimilarWordsList();
            
            // Go to role reveal
            changeScreen('screenSettings', 'screenRoleReveal');
            showPlayerRole();
        }
        
        // Update similar words list for display
        function updateSimilarWordsList() {
            const similarList = document.getElementById('similarWordsList');
            similarList.innerHTML = '';
            
            // Get 5 random words from the same category (excluding the actual word)
            const words = gameData.categories[gameData.currentCategory];
            const otherWords = words.filter(word => word !== gameData.actualWord);
            const randomWords = [...otherWords]
                .sort(() => Math.random() - 0.5)
                .slice(0, 5);
            
            randomWords.forEach(word => {
                const div = document.createElement('div');
                div.className = 'similar-word-tag';
                div.textContent = word;
                similarList.appendChild(div);
            });
        }
        
        // Show role for current player
        function showPlayerRole() {
            if (gameData.currentPlayerIndex >= gameData.players.length) {
                // All players have seen their roles
                startDiscussion();
                return;
            }
            
            const player = gameData.players[gameData.currentPlayerIndex];
            document.getElementById('currentPlayerName').textContent = player.name;
            
            // Reset display
            document.getElementById('wordDisplay').textContent = 'Swipe untuk melihat';
            document.getElementById('wordDisplay').style.color = 'var(--primary)';
            document.getElementById('categoryInfo').textContent = '';
            document.getElementById('similarWordHint').textContent = '';
            document.getElementById('roleCard').querySelector('.role-title').textContent = '?';
            document.getElementById('roleCard').querySelector('.role-title').className = 'role-title';
            
            // Show swipe arrow, hide next button
            document.getElementById('swipeArrow').style.display = 'block';
            document.getElementById('nextPlayerBtn').style.display = 'none';
        }
        
        // Reveal role (when player "swipes")
        function revealRole() {
            const player = gameData.players[gameData.currentPlayerIndex];
            const isImpostor = player.role === 'impostor';
            
            // Hide swipe arrow
            document.getElementById('swipeArrow').style.display = 'none';
            
            // Update role title
            const roleTitle = document.getElementById('roleCard').querySelector('.role-title');
            if (isImpostor) {
                roleTitle.textContent = 'üïµÔ∏è IMPOSTOR';
                roleTitle.className = 'role-title impostor-role';
            } else {
                roleTitle.textContent = 'üë§ WARGA';
                roleTitle.className = 'role-title citizen-role';
            }
            
            // Show word
            const wordDisplay = document.getElementById('wordDisplay');
            if (isImpostor) {
                wordDisplay.textContent = gameData.impostorWord;
                wordDisplay.innerHTML += ` <span class="similarity-indicator high-similarity">(mirip dengan "${gameData.actualWord}")</span>`;
                
                // Show hint about actual word
                document.getElementById('similarWordHint').textContent = 
                    `Kata asli berkaitan dengan: ${gameData.currentCategory}`;
            } else {
                wordDisplay.textContent = gameData.actualWord;
            }
            
            // Show category info
            document.getElementById('categoryInfo').textContent = 
                `Kategori: ${gameData.currentCategory}`;
            
            // Show next button
            document.getElementById('nextPlayerBtn').style.display = 'block';
            
            // Update button text
            const nextBtn = document.getElementById('nextPlayerBtn');
            nextBtn.innerHTML = gameData.currentPlayerIndex < gameData.players.length - 1
                ? `<i class="fas fa-arrow-right"></i> Pemain Selanjutnya`
                : `<i class="fas fa-play"></i> Mulai Diskusi`;
        }
        
        // Move to next player
        function nextPlayer() {
            gameData.currentPlayerIndex++;
            showPlayerRole();
        }
        
        // Start discussion phase
        function startDiscussion() {
            changeScreen('screenRoleReveal', 'screenGame');
            
            // Set up game info
            document.getElementById('currentCategoryDisplay').textContent = gameData.currentCategory;
            
            // Update player list for game
            updateGamePlayersList();
            
            // Update instruction based on current player
            const currentPlayer = gameData.players[0];
            const instruction = currentPlayer.role === 'impostor'
                ? `Anda adalah Impostor! Kata Anda "${gameData.impostorWord}" mirip dengan "${gameData.actualWord}". Berbaurlah!`
                : `Anda adalah Warga! Kata Anda adalah "${gameData.actualWord}". Berikan petunjuk tanpa mengungkap kata!`;
            document.getElementById('playerInstruction').textContent = instruction;
            
            // Start timer
            startGameTimer();
        }
        
        // Update game players list
        function updateGamePlayersList() {
            const gamePlayersList = document.getElementById('gamePlayersList');
            gamePlayersList.innerHTML = '';
            
            gameData.players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player-item';
                
                const roleBadge = player.role === 'impostor' 
                    ? '<span class="impostor-badge">‚ö° Impostor</span>' 
                    : '<span class="citizen-badge">üõ°Ô∏è Warga</span>';
                
                const currentIndicator = index === 0 ? ' üëà <span style="font-size: 0.9rem; opacity: 0.8;">(sedang memberi petunjuk)</span>' : '';
                
                div.innerHTML = `
                    <div>
                        <span style="font-weight: bold;">${player.name}</span>
                        ${roleBadge}
                    </div>
                    <div>${currentIndicator}</div>
                `;
                gamePlayersList.appendChild(div);
            });
        }
        
        // Game timer
        let gameTimer;
        function startGameTimer() {
            let timeLeft = gameData.roundDuration;
            updateTimerDisplay(timeLeft);
            
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimer);
                    startVoting();
                }
            }, 1000);
        }
        
        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('gameTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (seconds <= 30) {
                document.getElementById('gameTimer').style.color = 'var(--accent)';
            } else if (seconds <= 60) {
                document.getElementById('gameTimer').style.color = 'var(--warning)';
            }
        }
        
        function skipTurn() {
            if (confirm('Akhiri ronde diskusi sekarang?')) {
                clearInterval(gameTimer);
                startVoting();
            }
        }
        
        // Voting phase
        function startVoting() {
            clearInterval(gameTimer);
            changeScreen('screenGame', 'screenVoting');
            
            // Setup voting options
            const voteOptions = document.getElementById('voteOptions');
            voteOptions.innerHTML = '';
            
            gameData.players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'vote-item';
                div.innerHTML = `
                    <div>
                        <span style="font-weight: bold;">${player.name}</span>
                        ${player.role === 'impostor' ? '<span class="impostor-badge">‚ö°</span>' : ''}
                    </div>
                    <div style="opacity: 0.7;">Klik untuk vote</div>
                `;
                div.onclick = () => selectVote(player.id, div);
                voteOptions.appendChild(div);
            });
            
            // Reset voting state
            gameData.votes = {};
            document.getElementById('submitVoteBtn').disabled = true;
            document.getElementById('seeResultsBtn').style.display = 'none';
            document.getElementById('votingProgress').textContent = 'Belum ada yang vote';
        }
        
        let selectedVoteId = null;
        function selectVote(playerId, element) {
            // Remove selection from all
            document.querySelectorAll('.vote-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Select this one
            element.classList.add('selected');
            selectedVoteId = playerId;
            document.getElementById('submitVoteBtn').disabled = false;
        }
        
        function submitVote() {
            if (selectedVoteId) {
                // Record vote
                gameData.votes[selectedVoteId] = (gameData.votes[selectedVoteId] || 0) + 1;
                
                // Update UI
                document.getElementById('votingProgress').textContent = 'Vote Anda telah direkam!';
                document.getElementById('submitVoteBtn').style.display = 'none';
                document.getElementById('seeResultsBtn').style.display = 'block';
                
                // Auto-show results after delay
                setTimeout(showResults, 2000);
            }
        }
        
        // Show results
        function showResults() {
            changeScreen('screenVoting', 'screenResults');
            
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = '';
            
            // Calculate voting results
            let maxVotes = 0;
            let votedOutPlayer = null;
            let voteResults = [];
            
            for (const [playerId, voteCount] of Object.entries(gameData.votes)) {
                const player = gameData.players.find(p => p.id == playerId);
                if (player) {
                    voteResults.push({ player, voteCount });
                    if (voteCount > maxVotes) {
                        maxVotes = voteCount;
                        votedOutPlayer = player;
                    }
                }
            }
            
            // Sort by vote count
            voteResults.sort((a, b) => b.voteCount - a.voteCount);
            
            // Display results
            if (votedOutPlayer) {
                const isImpostor = votedOutPlayer.role === 'impostor';
                
                // Result header
                const resultHeader = document.createElement('div');
                resultHeader.style.textAlign = 'center';
                resultHeader.style.margin = '30px 0';
                
                if (isImpostor) {
                    resultHeader.innerHTML = `
                        <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
                        <h3 style="color: var(--success);">Impostor Terungkap!</h3>
                        <p style="font-size: 1.3rem; margin: 10px 0;">
                            ${votedOutPlayer.name} adalah <strong>Impostor</strong>!
                        </p>
                        <p style="opacity: 0.8;">Kata impostor: "${gameData.impostorWord}" (mirip dengan "${gameData.actualWord}")</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 10px;">WARGA MENANG!</p>
                    `;
                } else {
                    resultHeader.innerHTML = `
                        <div style="font-size: 4rem; margin-bottom: 20px;">üòû</div>
                        <h3 style="color: var(--accent);">Salah Menebak!</h3>
                        <p style="font-size: 1.3rem; margin: 10px 0;">
                            ${votedOutPlayer.name} adalah <strong>Warga</strong>, bukan Impostor!
                        </p>
                        <p style="opacity: 0.8;">Kata asli: "${gameData.actualWord}"</p>
                        <p style="color: var(--accent); font-weight: bold; margin-top: 10px;">IMPOSTOR MASIH BEBAS!</p>
                    `;
                }
                
                resultsContent.appendChild(resultHeader);
            }
            
            // Voting results table
            const resultsTable = document.createElement('div');
            resultsTable.innerHTML = '<h3><i class="fas fa-chart-bar"></i> Hasil Voting:</h3>';
            
            voteResults.forEach(result => {
                const div = document.createElement('div');
                div.className = 'result-item';
                
                const roleBadge = result.player.role === 'impostor'
                    ? '<span class="impostor-badge">‚ö° Impostor</span>'
                    : '<span class="citizen-badge">üõ°Ô∏è Warga</span>';
                
                div.innerHTML = `
                    <div>
                        <span style="font-weight: bold;">${result.player.name}</span>
                        ${roleBadge}
                    </div>
                    <div class="vote-count">${result.voteCount} votes</div>
                `;
                resultsTable.appendChild(div);
            });
            
            resultsContent.appendChild(resultsTable);
            
            // Show actual game info
            const gameInfo = document.createElement('div');
            gameInfo.style.marginTop = '30px';
            gameInfo.innerHTML = `
                <div class="game-info">
                    <h3><i class="fas fa-info-circle"></i> Info Game:</h3>
                    <p><strong>Kategori:</strong> ${gameData.currentCategory}</p>
                    <p><strong>Kata asli (Warga):</strong> ${gameData.actualWord}</p>
                    <p><strong>Kata impostor:</strong> ${gameData.impostorWord} <span class="similarity-indicator high-similarity">(mirip)</span></p>
                    <p><strong>Impostor:</strong> ${gameData.players.filter(p => p.role === 'impostor').map(p => p.name).join(', ')}</p>
                </div>
            `;
            resultsContent.appendChild(gameInfo);
        }
        
        // Play again
        function playAgain() {
            // Keep players, reset other data
            gameData.selectedCategories = [];
            gameData.impostors = [];
            gameData.currentCategory = "";
            gameData.actualWord = "";
            gameData.impostorWord = "";
            gameData.currentPlayerIndex = 0;
            gameData.votes = {};
            
            // Reset UI
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('categoryProgress').textContent = '0 kategori terpilih';
            document.getElementById('categoriesNextBtn').disabled = true;
            
            // Go to categories
            changeScreen('screenResults', 'screenCategories');
        }
        
        // Reset game completely
        function resetGame() {
            // Reset all data
            gameData.players = [];
            gameData.selectedCategories = [];
            gameData.impostors = [];
            gameData.currentCategory = "";
            gameData.actualWord = "";
            gameData.impostorWord = "";
            gameData.currentPlayerIndex = 0;
            gameData.votes = {};
            
            // Reset UI
            document.getElementById('playerInput').value = '';
            updatePlayerList();
            checkNextButton();
            
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.getElementById('categoryProgress').textContent = '0 kategori terpilih';
            document.getElementById('categoriesNextBtn').disabled = true;
            
            // Go to players screen
            changeScreen('screenResults', 'screenPlayers');
        }
        
        // Initialize when page loads
        window.onload = initGame;
    </script>
</body>
                                                  </html>
